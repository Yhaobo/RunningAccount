<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title id="title"></title>

    <link href="static/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="static/css/global.css" rel="stylesheet" type="text/css"/>


</head>
<body>
<header id="header"></header>
<table id="table">

</table>

<!--    注意: 要先导入jquery的js文件, 再导入bootstrap的js文件-->
<script src="static/js/jquery-3.4.1.min.js"></script>
<script src="static/bootstrap/js/bootstrap.min.js"></script>
<script src="static/layui/layui.all.js"></script>
<script src="static/js/util.js"></script>
<script src="static/js/load.js"></script>
<script>
    function init(data, isAll) {
        let html;
        if (isAll) {
            html = '<caption>' + decodeURIComponent(getParameter("title")) + '</caption>' +
                '       <tr>' +
                '            <th>月份</th>\n' +
                '            <th>收入</th>\n' +
                '            <th>支出</th>\n' +
                '            <th>结存</th>\n' +
                '       </tr>';
        } else {
            html = '<caption>' + decodeURIComponent(getParameter("title")) + '</caption>' +
                '       <tr>' +
                '            <th>月份</th>\n' +
                '            <th>收入</th>\n' +
                '            <th>支出</th>\n' +
                '       </tr>';
        }
        //收入合计
        let earning_total = 0;
        //支出合计
        let expense_total = 0;
        for (let i = 0; i < data.data.length; i++) {
            let item = data.data[i];
            if (isAll) {
                html += '<tr>\n' +
                    '            <td>' + dateFormat(new Date(item.date), "yyyy-MM") + '</td>\n' +
                    '            <td>' + item.formatEarning + '</td>\n' +
                    '            <td>' + item.formatExpense + '</td>\n' +
                    '            <td>' + item.formatBalance + '</td>\n' +
                    '        </tr>';
            } else {
                html += '<tr>\n' +
                    '            <td>' + dateFormat(new Date(item.date), "yyyy-MM") + '</td>\n' +
                    '            <td>' + item.formatEarning + '</td>\n' +
                    '            <td>' + item.formatExpense + '</td>\n' +
                    '        </tr>';
            }

            earning_total += item.earning * 100;
            expense_total += item.expense * 100;
        }

        if (isAll) {
            html += '<tr><td>合计</td><td>￥' + earning_total / 100 + '</td><td>￥' + expense_total / 100 + '</td><td></td></tr>';
        }else {
            html += '<tr><td>合计</td><td>￥' + earning_total / 100 + '</td><td>￥' + expense_total / 100 + '</td></tr>';

        }
        $("#table").html(html).addClass("table-hover");
    }


    let index = layer.load(2);

    function handleResult(result,isAll) {
        layer.close(index);
        if (result.flag) {
            init(result,isAll);
        } else {
            location.href = "index.html";
        }
    }

    $("#title").text(decodeURIComponent(getParameter("title")));

    if (getParameter("dep_id")) {
        $.get("group/findDepartment", {"dep_id": getParameter("dep_id")}, function (result) {
            handleResult(result,false);
        });
    } else if (getParameter("a_id")) {
        $.get("group/findAccount", {"a_id": getParameter("a_id")}, function (result) {
            handleResult(result,false);
        });
    } else if (getParameter("p_id")) {
        $.get("group/findProject", {"p_id": getParameter("p_id")}, function (result) {
            handleResult(result,false);
        });
    } else if (getParameter("c_id")) {
        $.get("group/findCategory", {"c_id": getParameter("c_id")}, function (result) {
            handleResult(result,false);
        });
    } else {
        $.get("group/findDetail", function (result) {
            handleResult(result,true);
        });
    }

</script>
</body>
</html>